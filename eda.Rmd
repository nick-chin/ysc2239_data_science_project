---
title: "EDA"
author: "Nick Chin"
date: "March 19, 2019"
output:
  html_document:
    df_print: paged
  word_document: default
---

We want to explore 2 different questions.

a. Are gini coefficients of different states dependent on other statewide factors such as education or the demographic of the state?

b. Are there clustering groups between state's gini coefficient and their share of trump voters?

```{r, message=FALSE}
library(readr)
data <- read_csv("data.csv")
names(data) <- c("state", "med_house_income", "prop_unemployed",
                 "prop_in_metro", "prop_hs_degree", "prop_non_cit",
                 "prop_wht_poverty", "gini_index", "prop_non_wht",
                 "prop_trump_vote", "splc_hate_crimes", "fbi_hate_crimes")
```

I renamed the data set to easily visualize for latter. Now we perform a matrix plot of all the columns except the state.

```{r, message=FALSE, warning=FALSE, fig.width=8, fig.height=8}
library(lattice)

splom(~data[-1], groups = NULL, data = data,
      axis.line.tck = 0,
      axis.text.alpha = 0,
      varname.cex = 0.6,
      varname.srt = 90)
```

Seems that there is some form of linearity between gini index and proportion of those with a highschool degree & poportion of the population that is not white.

```{r,warning=FALSE, message=FALSE}
gini_hs <- lm(gini_index ~ prop_hs_degree, data = data, action = na.omit)
summary(gini_hs)
plot(gini_index ~ prop_hs_degree, data = data)
abline(gini_hs)
plot(gini_hs, which = 1:2)
plot(resid(gini_hs))
```

```{r,warning=FALSE, message=FALSE}
gini_demo <- lm(gini_index ~ prop_non_wht, data = data, action = na.omit)
summary(gini_demo)
plot(gini_index ~ prop_non_wht, data = data)
abline(gini_demo)
plot(gini_demo, which = 1:2)
plot(resid(gini_demo))
```

It seems both variables are good predictors of the gini index. For both linear regressions, all 4 assumptions are met. Both plots show some weak to moderate linear trend. Looking at each Q-Q plot, both sets of residuals seem to be normally distributed, with some extreme outlier values. The residual values are homoscedastic, with both residuals vs fitted plots having equal spread of residuals along the fitted line. Finally the residuals are independent of each other as there is no pattern in either of the residuals vs index plot. It's also likely that they are independent since measurements in each state should not affect each other. Furthermore, there seems to be a common outlier, which is District of Columbia, as well as Hawaii for the demographics plot. In fact, removing them as outliers does improve the regression results and also better satisfies the assumptions of linear regression. 

```{r, warning=FALSE, message=FALSE, fig.width=10}
par(mfrow = c(2,3))

gini_hs <- lm(gini_index ~ prop_hs_degree, data = data[-9,], action = na.omit)
coef(summary(gini_hs))
plot(gini_index ~ prop_hs_degree, data = data[-9,],
     main = "gini vs prop with hs degree")
abline(gini_hs)
plot(gini_hs, which = 1:2)

gini_demo <- lm(gini_index ~ prop_non_wht, data = data[-c(9,12),], action = na.omit)
coef(summary(gini_demo))
plot(gini_index ~ prop_non_wht, data = data[-c(9,12),],
     main = "gini vs prop non white")
abline(gini_demo)
plot(gini_demo, which = 1:2)

par(mfrow = c(1,1))
```

It makes sense why District of Columbia is an outlier in both graphs. Washington DC is, for one, not considered a state and is very small. It's considered the capitol of the US, which could explain why income inequality can be so prevalent as many politicians and high ranking officials with lots of wealth live in the area. For Hawaii, it's demographics mainly consist native Hawaiians/pacific islanders, or Asians who immigrated there.

Since both predictors are statitically significant, we can reject the null hypothesis of each and conclude that the gini index does depend on the proportion of the population who has a highschool degree and the gini index depends on the proportion of the population who are non-white. 

To explore a separate effect, we want to explore if there are any interesting clusters of groups when perfoming k-means clustering on the gini index and proportion of Trump voters.

```{r, warning=FALSE, message=FALSE}
library(plyr)
library(ggplot2)
library(cluster)
library(graphics)
library(grid)
library(gridExtra)


data_scaled <- scale(data[-1]) # scale the data
data_scaled <- cbind(data[1], data_scaled) # add back in the state names

wss <- numeric(15)
for (k in 1:15) wss[k] <- sum(kmeans(data_scaled[c("gini_index", "prop_trump_vote")], centers=k, nstart=25)$withinss)
plot(1:15, wss, type="b", xlab="Number of Clusters", ylab="Within Sum ofSquares")
```

It seems that 5 clusters is an appropriate choice as the WSS decreases linearly for every additional cluster past that. Now we can plot the clusters.

```{r}
set.seed(1)

km <- kmeans(data_scaled[c("gini_index", "prop_trump_vote")], 5, nstart=25)
df <- as.data.frame(data_scaled)
df$cluster <- factor(km$cluster)
centers <- as.data.frame(km$centers)

g1 <- ggplot(data = df, aes(x = gini_index, y = prop_trump_vote, color = cluster )) +
  geom_point() + theme(legend.position="right") +
  geom_point(data = centers,
             aes(x = gini_index, y = prop_trump_vote, color= as.factor(c(1,2,3,4,5))),
             size = 10, alpha = .3, show.legend = FALSE)

plot(g1)
```

As we see again, District of Columbia is, yet again, an outlier. It is within a group of it's own. Now we try doing the k-means clustering without Washington DC within the dataset.

```{r}
data_scaled2 <- scale(data[-9,-1]) # scale the data
data_scaled2 <- cbind(data[-9,1], data_scaled2) # add back in the state names

wss <- numeric(15)
for (k in 1:15) wss[k] <- sum(kmeans(data_scaled2[c("gini_index", "prop_trump_vote")], centers=k, nstart=25)$withinss)
plot(1:15, wss, type="b", xlab="Number of Clusters", ylab="Within Sum ofSquares")
```

This time 4 clusters seems appropriate, as expected.

```{r}
set.seed(1)

km <- kmeans(data_scaled2[c("gini_index", "prop_trump_vote")], 4, nstart=25)
df2 <- as.data.frame(data_scaled2)
df2$cluster <- factor(km$cluster)
centers <- as.data.frame(km$centers)

g2 <- ggplot(data = df2, aes(x = gini_index, y = prop_trump_vote, color = cluster )) +
  geom_point() + theme(legend.position="right") +
  geom_point(data = centers,
             aes(x = gini_index, y = prop_trump_vote, color= as.factor(c(1,2,3,4))),
             size = 10, alpha = .3, show.legend = FALSE)

plot(g2)
```

Now lets see where these states are in each group

```{r}
clustered_states <- df2[order(df2$cluster),c("state","cluster")]
```
Below is the colored in map, done manually. It seems that cluster 4 is regionally connected, located in southern United States. This suggests that that income inquality and share of trump voters are all similar in that region.
![](https://tinyurl.com/y49hqtws)